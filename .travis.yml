sudo: required
dist: xenial
language: c
compiler:
  - gcc
before_script:
  - ulimit -c unlimited -S
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 3
install:
  - sudo apt-get install -q -y gdb
  - sudo apt-get install -q -y colorgcc
  - sudo apt-get install -q -y freeglut3-dev
  - sudo apt-get install -q -y libglew-dev
  - sudo apt-get install -q -y libmagickcore-dev
  - sudo apt-get install -q -y libgc-dev
  - make fsim
script:
  - make check
after_failure:
  - COREFILE=$(find . -maxdepth 1 -name "core*" | head -n 1)
  - if [[ -f "$COREFILE" ]]; then gdb -c "$COREFILE" fsim -ex "thread apply all bt" -ex "set pagination 0" -batch; fi
